<?php /* * Developer : pan-x (info@pan-x.com) * All code (c)2013 pan-x all rights reserved */ class Autologin extends CI_Controller {
    function Autologin(){	   parent::__construct();	   $this->load->model('userModel','',TRUE);       $this->load->model('clientModel','',TRUE);       $this->load->model('householdModel','',TRUE);       unset($_SESSION['household']);    }
    function index(){        //Field validation succeeded.  Validate against database        $checkstring = $this->input->get('checkstring');
        //query the database        $result_user = $this->userModel->autologin($checkstring);
        if($result_user) {            foreach($result_user as $row_user) {                $_SESSION['user'] =  array('loginLevel' => $row_user->loginLevel,'id' => $row_user->id, 'username' => $row_user->username);    		    $this->clientModel->load_session_by_id($row_user->client_id);                // if HH add household_id                $pos = strpos($row_user->username,'HH_');                if($pos !== false){                    $result_household = $this->householdModel->get_by_user_id($row_user->id);                    if ( $result_household->num_rows > 0 ){                        $row_household = $result_household->row_array();                        $_SESSION['household']['household_id'] = $row_household['household_id'];                    }                }            }			redirect('home', 'refresh');        } else		    redirect('login', 'refresh');		}}